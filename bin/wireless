#!/usr/bin/perl

use strict;
use warnings;

use Term::ANSIColor;

my $wicd_cmd = join("\n", qx{wicd-cli -d --wireless} );
my $regex    = 'Quality: ([0-9]{1,3})';
print show_bar( $wicd_cmd, $regex, @ARGV );

sub show_bar {
    my $wicd_cmd = shift;
    my $regex    = shift;
    my @args     = @_;

    my @graph  = qw{ ▁ ▂ ▃ ▅ ▇ };
    my @colors = qw{ green yellow red };

    if ( $wicd_cmd =~ /$regex/ ) {
        my $c;
        my $g = $graph[  ( ( $1 * 4) / 100 ) ];

        if    ( $1 > 75 ) { $c = $colors[0]; }
        elsif ( $1 > 25 ) { $c = $colors[1]; }
        else              { $c = $colors[2]; }

        my $string = sprintf ( "[%s] %s", $1 . '%', $g );

        for my $arg ( @args ) {
            if  ( $arg eq 'mini' ) {
                $string = sprintf ( "%s", $g );
                next;
            }
            if  ( $arg eq 'tmux' ) {
                return '#[fg=' . $c . ']' . $string . "#[default]\n";
            }
        }

        return colored [ $c ], $string . "\n";
    }
}
